

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>C++ data structures and HDF5 &#8212; h5cpp 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="C-style arrays" href="c_arrays.html" />
    <link rel="prev" title="Advanced IO" href="io.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="c_arrays.html" title="C-style arrays"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="io.html" title="Advanced IO"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">h5cpp 0.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Advanced topics</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="io.html" accesskey="U">Advanced IO</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">C++ data structures and HDF5</a><ul>
<li><a class="reference internal" href="#stl-containers">STL containers</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="io.html"
                        title="previous chapter">Advanced IO</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="c_arrays.html"
                        title="next chapter">C-style arrays</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/advanced/cpp_datastructures.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="c-data-structures-and-hdf5">
<span id="advanced-cpp-datastructures"></span><h1>C++ data structures and HDF5<a class="headerlink" href="#c-data-structures-and-hdf5" title="Permalink to this headline">¶</a></h1>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Add here some content about C++ data structures and about the principal
difficulties with them when working with HDF5.</p>
</div>
<p>The HDF5 library is a C-library and thus it is primarily intended to be
used with C-style data structures. These are</p>
<ul class="simple">
<li>simple scalar values of a primitive type</li>
<li><code class="xref cpp cpp-any docutils literal"><span class="pre">struct</span></code> instances</li>
<li>pointers and array of pointers.</li>
</ul>
<p>C++ provides a far more richer set of data structures including for instances
classes. But also more elaborate compound types could be built in particular
when making use of STL containers.</p>
<div class="section" id="stl-containers">
<h2>STL containers<a class="headerlink" href="#stl-containers" title="Permalink to this headline">¶</a></h2>
<p>Recall now the concept of the memory storage introduced in the users guide
(see <a class="reference internal" href="../users_guide/overview.html#ug-design-overview"><span class="std std-ref">Design overview</span></a> for details). Except for three situations
where which will be covered also in the advanced chapter of the
documentation HDF5 always assumes that the memory storage from which it
reads or to which it writes data is contiguous and can be adressed linearly.
The only two data structures in the STL which satisfy this requirement are the
two templates</p>
<ul class="simple">
<li><code class="xref cpp cpp-class docutils literal"><span class="pre">std::vector</span></code></li>
<li><code class="xref cpp cpp-class docutils literal"><span class="pre">std::array</span></code>.</li>
</ul>
<p>In this case the <code class="xref cpp cpp-func docutils literal"><span class="pre">data()</span></code> method provided by both templates would be
already sufficient for low level HDF5 IO as the pointer returned by this
method would reference a block of memory that entirely satisifies the
requirements for memory storage.</p>
<p>However, already defining a vector of vectors would make no longer be
compliant with a memor storage. Cnsider the following example</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">BinType</span>    <span class="o">=</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">;</span>
<span class="k">using</span> <span class="n">MCAReadout</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BinType</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">MCAStack</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">MCAReadout</span><span class="o">&gt;</span><span class="p">;</span>

<span class="cp">#define NBINS 1024</span>
<span class="cp">#define NMCAS 100</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">hdf5</span><span class="p">;</span>

<span class="c1">// create the dataset</span>
<span class="n">node</span><span class="o">::</span><span class="n">Gruop</span> <span class="n">data_group</span> <span class="o">=</span> <span class="p">....;</span>
<span class="k">auto</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">datatype</span><span class="o">::</span><span class="n">create</span><span class="o">&lt;</span><span class="n">BinType</span><span class="o">&gt;</span><span class="p">;</span>
<span class="n">dataspace</span><span class="o">::</span><span class="n">Simple</span> <span class="n">file_space</span><span class="p">({</span><span class="n">NMCAS</span><span class="p">,</span><span class="n">NBINS</span><span class="p">})</span>
<span class="n">node</span><span class="o">::</span><span class="n">Dataset</span> <span class="n">dset</span> <span class="o">=</span> <span class="n">data_gruop</span><span class="p">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&quot;mcas&quot;</span><span class="p">,</span><span class="n">file_type</span><span class="p">,</span><span class="n">file_space</span><span class="p">);</span>

<span class="c1">// create the data</span>
<span class="n">MCAStack</span> <span class="n">mcas</span><span class="p">;</span>
<span class="n">MCAReader</span> <span class="n">reader</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">generate_n</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">back_inserter</span><span class="p">(</span><span class="n">mcas</span><span class="p">),</span><span class="n">NMCAS</span><span class="p">,</span><span class="n">reader</span><span class="p">);</span>


<span class="c1">//now lets try to write the data</span>
<span class="n">dset</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">mcas</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="c_arrays.html" title="C-style arrays"
             >next</a> |</li>
        <li class="right" >
          <a href="io.html" title="Advanced IO"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">h5cpp 0.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Advanced topics</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="io.html" >Advanced IO</a> &#187;</li> 
      </ul>
    </div>
<li>generated on 2018-12-06 14:13:43 from master (5773bdf)</li>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Deutsches Elektronen-Synchrotron, European Spallation Source ERIC; generated on 2018-12-06 14:13:43 from master (5773bdf).
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.2.
    </div>

  </body>
</html>